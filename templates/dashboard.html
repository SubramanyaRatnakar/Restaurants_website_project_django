<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 30px; background: #fafafa; }
        h1 { color: #2c3e50; }
        .metrics { display: flex; gap: 30px; margin-bottom: 30px; }
        .card {
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); flex: 1;
        }
        .chart-container { margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    </style>
</head>
<body>
    <h1>üìä Admin Dashboard</h1>
    <div class="metrics">
        <div class="card">üë• Total Users: <strong>{{ total_users }}</strong></div>
        <div class="card">üÜï New Users This Week: <strong>{{ new_users_week }}</strong></div>
        <div class="card">üçΩÔ∏è Total Items: <strong>{{ total_items }}</strong></div>
        <div class="card">üí¨ Feedbacks: <strong>{{ total_feedbacks }}</strong></div>
    </div>

    <div class="card">
        <h2>üïí Recent Feedback</h2>
        <table>
            <thead><tr><th>User</th><th>Comment</th><th>Image</th></tr></thead>
            <tbody>
                {% for fb in recent_feedbacks %}
                    <tr>
                        <td>{{ fb.user_name }}</td>
                        <td>{{ fb.comment|truncatechars:100 }}</td>
                        <td>
                            {% if fb.image %}
                                <img src="{{ fb.image.url }}" width="50" />
                            {% else %}
                                No image
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card chart-container">
        <h2>üìà Item Popularity</h2>
        <canvas id="itemChart"></canvas>
    </div>

    <!-- User Growth Chart -->
<div class="card chart-container">
    <h2>üìÖ User Growth (Last 4 Weeks)</h2>
    <canvas id="growthChart"></canvas>
</div>

<!-- Feedback Rating Chart -->
<div class="card chart-container">
    <h2>‚≠ê Feedback Ratings</h2>
    <canvas id="ratingChart"></canvas>
</div>

<!-- Category Chart -->
<div class="card chart-container">
    <h2>üçï Menu Category Distribution</h2>
    <canvas id="categoryChart"></canvas>
</div>

    <script>
        const ctx = document.getElementById('itemChart').getContext('2d');
        const itemChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: {{ item_names|safe }},
                datasets: [{
                    label: 'Orders',
                    data: {{ item_counts|safe }},
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderRadius: 10
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Item Popularity Chart (already existing)
    const ctx = document.getElementById('itemChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ item_names|safe }},
            datasets: [{
                label: 'Orders',
                data: {{ item_counts|safe }},
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderRadius: 10
            }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // User Growth Chart
    const growthChart = new Chart(document.getElementById('growthChart'), {
        type: 'line',
        data: {
            labels: {{ user_growth|map(attribute='week')|list|safe }},
            datasets: [{
                label: 'New Users',
                data: {{ user_growth|map(attribute='count')|list|safe }},
                borderColor: 'rgb(54, 162, 235)',
                tension: 0.3,
                fill: false
            }]
        },
        options: { responsive: true }
    });

    // Feedback Ratings
    const ratingChart = new Chart(document.getElementById('ratingChart'), {
        type: 'bar',
        data: {
            labels: {{ rating_data|map(attribute='rating')|list|safe }},
            datasets: [{
                label: 'Feedback Count',
                data: {{ rating_data|map(attribute='count')|list|safe }},
                backgroundColor: 'rgba(255, 206, 86, 0.6)'
            }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // Category Distribution
    const categoryChart = new Chart(document.getElementById('categoryChart'), {
    type: 'pie',
    data: {
        labels: {{ category_data|map(attribute='category__Category_name')|list|safe }},
        datasets: [{
            data: {{ category_data|map(attribute='count')|list|safe }},
            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#8e44ad', '#2ecc71']
        }]
    },
    options: { responsive: true }
});

    </script>
</body>
</html>